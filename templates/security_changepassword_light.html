{% extends "base.html" %}
{% block title %}{{ t("security_change_password.title") }}{% endblock %}
{% block css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='security_changepassword_light.css') }}"
/>
{% endblock %}

{% block content %}
<div class="top-spacer"></div>

<div class="settings-container">
  <div class="preference-sidebar">
    <a href="{{ url_for('setting') }}" class="preference-sidebar-item">
      {{ t("security_change_password.sidebar_edit_profile") }}
    </a>
    <a href="{{ url_for('change_password') }}" class="preference-sidebar-item active">
      {{ t("security_change_password.sidebar_security") }}
    </a>
    <a href="{{ url_for('preference') }}" class="preference-sidebar-item">
      {{ t("security_change_password.sidebar_preference") }}
    </a>
  </div>

  <div class="settings-content">
    <h1>{{ t("security_change_password.heading_security") }}</h1>

    <div class="tabs">
      <a
        href="{{ url_for('change_password') }}"
        class="tab {% if active_tab == 'password' %}active{% endif %}"
        id="change_password"
      >
        {{ t("security_change_password.tab_password") }}
      </a>
      <a
        href="{{ url_for('setting_2fa') }}"
        class="tab {% if active_tab == '2fa' %}active{% endif %}"
        id="setting_2fa"
      >
        {{ t("security_change_password.tab_2fa") }}
      </a>
    </div>

    <div class="alert-box">
      ⚠️ <strong>{{ t("security_change_password.alert_warning_title") }}</strong><br />
      {{ t("security_change_password.alert_warning_text") }}
    </div>

    <form method="POST" class="password-form">
      <label for="current_password">{{ t("security_change_password.form_current_password") }}</label>
      <input type="password" name="current_password" required minlength="7">

      <div class="password-row">
        <div>
          <label for="new_password">{{ t("security_change_password.form_new_password") }}</label>
          <input type="password" name="changed_password" required minlength="7">
        </div>
        <div>
          <label for="confirm_new_password">{{ t("security_change_password.form_confirm_new_password") }}</label>
          <input type="password" name="confirm_new_password" required minlength="7">
        </div>
      </div>

      <span>{{ message }}</span>

      <input
        type="submit"
        value="{{ t("security_change_password.submit_change_password") }}"
        class="submit-btn"
        id="submit-btn"
      />
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sidebar   = document.querySelector('.preference-sidebar');
    const indicator = sidebar.querySelector('.sidebar-indicator');
    const active    = sidebar.querySelector('.active');

    function moveIndicator(el) {
      indicator.style.top    = el.offsetTop + 'px';
      indicator.style.height = el.offsetHeight + 'px';
    }

    indicator.style.top    = '0px';
    indicator.style.height = `${active.offsetHeight}px`;
    setTimeout(() => moveIndicator(active), 50);
  });
</script>
{% endblock %}
