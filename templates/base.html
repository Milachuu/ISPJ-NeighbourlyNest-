<!DOCTYPE html>
<html lang="en"
      data-theme="{{ current_theme }}"
      {% if current_theme == 'system' %}
      data-theme-effective="{{ 'dark' if (request.user_agent and request.user_agent.string) and false else '' }}"
      {% endif %}
      data-font="{{ current_font_size|default(100) }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}{% endblock %}</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

  <!-- Your main CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/font-scale.css') }}">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/logo without word.png') }}">

  {% block css %}{% endblock %}

  <!-- Fonts / Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Caveat:wght@400..700&family=Great+Vibes&family=Oswald:wght@200..700&family=Ovo&family=Rubik+Glitch&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <script>
    (function () {
    const root = document.documentElement;
    const applySystem = () => {
        const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        root.setAttribute('data-theme-effective', isDark ? 'dark' : 'light');
    };
    if (root.getAttribute('data-theme') === 'system') {
        applySystem();
        try {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applySystem);
        } catch (e) {
        window.matchMedia('(prefers-color-scheme: dark)').addListener(applySystem);
        }
    } else {
        root.removeAttribute('data-theme-effective');
    }
    })();
  </script>

  <script>
  (function () {
    // THEME
    var theme = "{{ current_theme|default('system') }}";
    var root = document.documentElement;
    root.setAttribute('data-theme', theme);
    if (theme === 'system') {
      var isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      root.setAttribute('data-theme-effective', isDark ? 'dark' : 'light');
      try {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function (e) {
          root.setAttribute('data-theme-effective', e.matches ? 'dark' : 'light');
        });
      } catch(_) {}
    } else {
      root.removeAttribute('data-theme-effective');
    }

    // FONT (numeric 100 / 112 only)
    var fs = Number("{{ current_font_size|default(100) }}") || 100;
    root.setAttribute('data-font', String(fs));
  })();
  </script>


</head>

<body>

  <!-- FLEX WRAPPER: this is what makes the footer stick -->
  <div class="page-container">
    <!-- Fixed header / navbar -->
    <header class="menu__bar" role="banner">
      {% block navbar %}
        {% include 'includes/login_navbar.html' %}
      {% endblock %}
    </header>

    <!-- Main content grows to fill the viewport -->
    <main class="main-content" role="main">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer sits flush at bottom even with no content -->
    <footer class="footer" role="contentinfo">
      {% block footer %}
        {% include 'includes/footer.html' %}
      {% endblock %}
    </footer>
  </div>

  <!-- Keep the chatbot fixed-positioned; it doesnâ€™t belong inside footer layout -->
  {% include 'includes/chatbot.html' %}

  {% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>

    {% if current_lang != 'EN' %}
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const textNodes = [];
        const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
        while (walker.nextNode()) {
          const node = walker.currentNode;
          if (node.textContent.trim().length > 1 &&
              node.parentNode.tagName !== 'SCRIPT' &&
              node.parentNode.tagName !== 'STYLE') {
            textNodes.push(node);
          }
        }
        const originalTexts = textNodes.map(n => n.textContent.trim());
        fetch("/translate", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ text: originalTexts.join("\n###\n"), target_lang: "{{ current_lang }}" })
        })
        .then(res => res.json())
        .then(data => {
          const translatedChunks = data.translations[0].text.split("\n###\n");
          textNodes.forEach((node, i) => { if (translatedChunks[i]) node.textContent = translatedChunks[i]; });
        });
      });
    </script>
    {% endif %}
  {% endblock %}
</body>
</html>
